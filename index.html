<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alpha Sniff AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-5xl font-bold text-center mb-8 bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
            üîç Alpha Sniff AI
        </h1>
        
        <div class="bg-gray-800 rounded-2xl p-8 mb-6">
            <div class="mb-6">
                <label class="block text-sm font-semibold mb-3">Select Blockchain</label>
                <div class="flex gap-3">
                    <button onclick="selectChain('solana')" id="btnSolana" class="flex-1 py-3 px-6 rounded-xl font-semibold bg-purple-600 text-white">
                        Solana
                    </button>
                    <button onclick="selectChain('bsc')" id="btnBsc" class="flex-1 py-3 px-6 rounded-xl font-semibold bg-gray-700 text-gray-300">
                        BSC
                    </button>
                </div>
            </div>

            <div class="mb-6">
                <label class="block text-sm font-semibold mb-3">Token Address</label>
                <input 
                    type="text" 
                    id="tokenInput"
                    placeholder="Paste token address..."
                    class="w-full bg-gray-700 border border-gray-600 rounded-xl py-4 px-5 text-white"
                >
            </div>

            <button 
                onclick="scanToken()"
                id="scanBtn"
                class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold py-4 px-6 rounded-xl"
            >
                üîç Sniff This Token
            </button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        let chain = 'solana';
        const API = 'https://pelwayne--2e77d232f02211f0a0c942dde27851f2.web.val.run';

        function selectChain(c) {
            chain = c;
            if (c === 'solana') {
                document.getElementById('btnSolana').className = 'flex-1 py-3 px-6 rounded-xl font-semibold bg-purple-600 text-white';
                document.getElementById('btnBsc').className = 'flex-1 py-3 px-6 rounded-xl font-semibold bg-gray-700 text-gray-300';
            } else {
                document.getElementById('btnBsc').className = 'flex-1 py-3 px-6 rounded-xl font-semibold bg-yellow-600 text-white';
                document.getElementById('btnSolana').className = 'flex-1 py-3 px-6 rounded-xl font-semibold bg-gray-700 text-gray-300';
            }
        }

        async function scanToken() {
            const input = document.getElementById('tokenInput').value.trim();
            if (!input) {
                alert('Please enter a token address');
                return;
            }

            const btn = document.getElementById('scanBtn');
            const res = document.getElementById('results');

            btn.disabled = true;
            btn.innerHTML = 'Scanning...';
            
            res.innerHTML = '<div class="bg-gray-800 rounded-2xl p-8 text-center">Loading...</div>';

            try {
                let addr = input;
                if (addr.includes('dexscreener.com')) {
                    const m = addr.match(/\/([a-zA-Z0-9]+)$/);
                    if (m) addr = m[1];
                }

                console.log('Scanning:', addr, 'Chain:', chain);
                
                const response = await fetch(API + '/api/scan/' + addr + '?chain=' + chain);
                const data = await response.json();

                console.log('Response:', data);

                if (!response.ok || !data.success) {
                    throw new Error(data.error || 'Scan failed');
                }

                const score = calculateScore(data.data);
                showResults(data.data, addr, score);

            } catch (e) {
                console.error('Error:', e);
                res.innerHTML = `<div class="bg-red-900/20 border border-red-500 rounded-xl p-6 text-red-300">
                    ‚ùå Error: ${e.message}
                </div>`;
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'üîç Sniff This Token';
            }
        }

        function calculateScore(token) {
            let score = 0;
            
            const liq = parseFloat(token.liquidity) || 0;
            if (liq >= 100000) score += 25;
            else if (liq >= 50000) score += 20;
            else if (liq >= 10000) score += 15;
            else score += 5;
            
            const vol = parseFloat(token.volume24h) || 0;
            if (vol >= 100000) score += 20;
            else if (vol >= 50000) score += 15;
            else if (vol >= 10000) score += 10;
            else score += 5;
            
            if (token.holderData && !token.holderData.error) {
                const topHolder = parseFloat(token.holderData.topHolderPercent) || 0;
                if (topHolder < 5) score += 20;
                else if (topHolder < 10) score += 15;
                else if (topHolder < 20) score += 10;
                else score += 5;
            } else {
                score += 10;
            }
            
            if (token.contractSafety && !token.contractSafety.error) {
                let safetyScore = 0;
                if (token.chain === 'solana') {
                    if (token.contractSafety.mintAuthorityRevoked) safetyScore += 10;
                    if (token.contractSafety.freezeAuthorityDisabled) safetyScore += 10;
                } else {
                    if (token.contractSafety.ownershipRenounced) safetyScore += 10;
                    if (!token.contractSafety.hasPauseFunction) safetyScore += 5;
                    if (!token.contractSafety.canMint) safetyScore += 5;
                }
                score += safetyScore;
            } else {
                score += 10;
            }
            
            if (token.honeypotCheck) {
                if (!token.honeypotCheck.isHoneypot) {
                    score += 5;
                } else {
                    score -= 50;
                }
            }
            
            if (token.socialInfo) {
                let socialScore = 0;
                if (token.socialInfo.hasTwitter) socialScore += 6;
                if (token.socialInfo.hasWebsite) socialScore += 4;
                
                if (socialScore === 0) {
                    score -= 5;
                } else {
                    score += socialScore;
                }
            }
            
            return Math.min(100, Math.max(0, score));
        }

        function showResults(token, addr, score) {
            const verdict = score >= 70 ? '‚úÖ SAFE' : score >= 40 ? '‚ö†Ô∏è RISKY' : '‚ùå DANGER';
            const color = score >= 70 ? 'emerald' : score >= 40 ? 'yellow' : 'red';
            const tokenChain = (token.chain || chain || 'solana').toUpperCase();

            let html = `
                <div class="bg-gray-800 rounded-2xl p-8 mb-6">
                    <h2 class="text-3xl font-bold mb-2">${token.name || 'Unknown'}</h2>
                    <p class="text-xl text-gray-400 mb-4">$${token.symbol || 'N/A'} ‚Ä¢ ${tokenChain}</p>
                    
                    <div class="text-center my-8">
                        <div class="text-6xl font-bold text-${color}-400 mb-2">${score}</div>
                        <div class="text-2xl font-semibold text-${color}-400">${verdict}</div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mt-6">
                        <div class="bg-gray-700 rounded-xl p-4">
                            <p class="text-gray-400 text-sm">Liquidity</p>
                            <p class="text-xl font-bold">$${(token.liquidity || 0).toLocaleString()}</p>
                        </div>
                        <div class="bg-gray-700 rounded-xl p-4">
                            <p class="text-gray-400 text-sm">Volume 24h</p>
                            <p class="text-xl font-bold">$${(token.volume24h || 0).toLocaleString()}</p>
                        </div>
                        <div class="bg-gray-700 rounded-xl p-4">
                            <p class="text-gray-400 text-sm">Price</p>
                            <p class="text-xl font-bold">$${token.priceUsd || '0'}</p>
                        </div>
                        <div class="bg-gray-700 rounded-xl p-4">
                            <p class="text-gray-400 text-sm">Market Cap</p>
                            <p class="text-xl font-bold">$${((token.marketCap || 0)/1000000).toFixed(2)}M</p>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('results').innerHTML = html;
        }
    </script>
</body>
</html>
